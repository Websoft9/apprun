---
stepsCompleted: []
inputDocuments: 
  - "docs/analysis/product-brief.md"
documentCounts:
  briefs: 1
  research: 0
  brainstorming: 0
  projectDocs: 0
workflowType: 'prd'
lastStep: 0
project_name: 'apprun'
user_name: 'Root'
date: '2025-12-24'
status: 'active'
version: '5.0-bmad-compliant'
---

# Product Requirements Document - apprun (BMad v5.0)

**Author:** Root  
**Date:** 2025-12-24  
**Status:** Active  
**Related Documents:** [Product Brief](./analysis/product-brief.md)

---

## 1. 文档说明

### 1.1 文档目的与简化原则

本 PRD 定义 apprun BaaS 平台的**核心功能需求（FR）**和**非功能需求（NFR）**。

**BMad 方法论合规性**：
1. **职责分离**：PRD 定义 "需要什么能力"，不预设 "用什么技术实现"
2. **技术决策延后**：具体技术选型推迟到技术架构阶段
3. **聚焦验收标准**：明确可测试的业务价值和验收标准
4. **架构输入**：提供实现约束和决策点，供架构师参考

**简化原则**：
1. **能力导向**：描述需要的能力，而非实现方式
2. **合并细节需求**：相关的细节功能需求合并为单一 FR
3. **明确约束**：提供实现约束，指导架构决策
4. **保留灵活性**：技术选型在架构阶段根据实际情况决策

**与 Product Brief 的关系**：

- **Product Brief**：定义商业愿景、市场定位、12 个核心模块
- **PRD（本文档）**：定义可验收的功能需求，区分自研 vs 集成

### 1.2 目标用户

- 架构师：技术选型和集成方案设计
- 开发团队：自研模块实现
- 测试团队：集成测试和验收标准
- 产品经理：进度跟踪和范围管理

---

## 2. 核心模块功能需求

### 2.1 认证与权限（Priority 1）

#### FR-AUTH-001：认证与权限服务

- **需求**：提供完整的用户认证、授权和团队协作能力
- **核心能力**：
  - 用户注册、登录、登出
  - JWT Token 认证
  - Project-based 团队协作和权限管理
  - RBAC 角色权限管理
- **验收标准**：
  - 用户可通过统一接口注册和登录
  - Token 验证集成到 API 网关
  - 用户可加入多个 Project，Project 间权限正确隔离
  - 权限验证正确（未授权访问返回 403）

**实现约束**（供架构阶段参考）：
- 优先考虑成熟的第三方认证服务（降低开发成本、提高安全性）
- 必须支持自托管部署（企业数据安全要求）
- 需提供统一的 API 封装层（隔离底层实现）
- 必须支持扩展点（自定义用户属性、多因素认证等）

**架构阶段决策点**：
- 自研 vs 集成第三方（评估开发成本、安全性、维护成本）
- 如选择集成：具体产品选型和集成方式
- 扩展机制设计

---

### 2.2 数据建模（Priority 2）

#### FR-DATA-001：数据模型定义与管理
- **需求**：支持 DSL 或配置化定义数据模型，自动生成 CRUD API
- **核心能力**：
  - 字段类型定义（String, Integer, Boolean, JSON, DateTime, UUID 等）
  - 字段约束（必填、唯一、长度限制、默认值）
  - 关系定义（一对多、多对多、自关联）
  - 索引定义（单列、复合索引）
  - Schema 迁移管理（版本化、回滚）
- **验收标准**：
  - 用户可通过配置文件定义数据模型
  - 模型定义后自动生成数据库表和 RESTful API
  - API 支持分页、过滤、排序、关联查询
  - API 响应时间 P95 < 100ms
  - Schema 变更可生成迁移脚本并支持回滚

**实现约束**（供架构阶段参考）：
- 需支持多种数据库后端（PostgreSQL, MySQL 等）
- DSL 设计需简洁易用（降低学习成本）
- 迁移机制需保证安全（防止数据丢失）

**架构阶段决策点**：
- 数据模型定义语言（YAML vs JSON vs 自定义 DSL）
- ORM 框架选型（评估性能、易用性、社区支持）

---

### 2.3 配置中心（Priority 3）

#### FR-CONFIG-001：配置管理服务
- **需求**：集中式配置存储、管理和动态更新
- **核心能力**：
  - 文件和 Key-Value 数据库库配置存储
  - 配置优先级
  - 动态配置更新（无需重启）
- **验收标准**：
  - 配置可通过 API 增删改查
  - 第三方微服务的配置项变更后实时发布到事件中心
  - 配置变更历史可查询

**实现约束**（供架构阶段参考）：
- 需支持高并发读取（配置访问频繁）
- 推送机制需可靠（确保应用获取最新配置）
- 需支持配置加密（敏感信息保护）

**架构阶段决策点**：
- 配置推送机制（WebSocket vs 长轮询 vs gRPC）
- 存储后端选型（内存 + 持久化策略）
- 配置加密方案
---

### 2.4 函数服务（Priority 4）

#### FR-FUNC-001：函数执行服务
- **需求**：支持用户自定义函数部署和执行
- **核心能力**：
  - 支持 golang 语言
  - HTTP 触发执行
  - 资源限制（CPU, 内存, 超时）
  - 函数日志收集
- **验收标准**：
  - 用户可上传函数代码并部署
  - 函数可通过 HTTP 调用
  - 函数执行相互隔离
  - 函数日志可查询

**实现约束**（供架构阶段参考）：
- 需保证函数隔离性（安全性要求）
- 需优化冷启动时间（用户体验）
- 需支持函数扩展和编排（后续演进）

**架构阶段决策点**：
- 运行时选型（容器 vs WASM vs 进程隔离）
- 冷启动优化方案（预热、池化等）
- 函数编排能力（是否需要、如何实现）

---

### 2.5 存储服务（Priority 5）

#### FR-STORAGE-001：对象存储服务
- **需求**：提供文件和对象存储能力
- **核心能力**：
  - 文件上传、下载、删除
  - 文件列表查询（分页、过滤）
  - 生成文件访问 URL
  - 分片上传（大文件 >10MB）
- **验收标准**：
  - 文件上传成功返回 URL
  - 文件可通过 URL 访问
  - 文件元信息可查询

**实现约束**（供架构阶段参考）：
- 优先考虑集成成熟对象存储服务（降低开发成本）
- 需提供统一的 API 封装层（支持多后端切换）
- 必须支持自托管方案（企业数据安全要求）
- 可选图片处理能力（评估业务需求和成本）

**架构阶段决策点**：
- 自研 vs 集成第三方对象存储
- 如选择集成：具体产品选型（评估成本、功能、易用性）
- 多后端支持策略（单一后端 vs 多后端适配）
- 图片处理方案（集成第三方 vs 自研 vs 不实现）

---

### 2.6 工作流服务（Priority 6）

#### FR-WORKFLOW-001：工作流引擎
- **需求**：提供可靠的工作流编排和执行能力
- **核心能力**：
  - 工作流定义（YAML/代码）
  - 多种触发方式（事件、定时、手动）
  - 内置节点（HTTP, SMTP, 数据库等）
  - 自定义节点扩展
- **验收标准**：
  - 工作流可被定义和触发
  - 工作流执行状态可查询
  - 失败自动重试（可配置）
  - Cron 定时任务按计划执行

**实现约束**（供架构阶段参考）：
- 优先考虑集成现有工作流引擎（已有 Waterflow 项目）
- 需支持 Durable Execution（长时间运行任务）
- 需提供统一的 API 封装层（隔离底层实现）
- 必须支持自定义节点扩展（业务灵活性）

**架构阶段决策点**：
- 集成 Waterflow 的方式（嵌入式 vs 独立服务）
- 工作流定义存储位置（数据库 vs 配置中心）
- 与其他模块的集成方式（事件中心、函数服务等）

---

### 2.7 事件中心（Priority 7）

#### FR-EVENT-001：事件总线服务
- **需求**：提供微服务间的事件发布/订阅能力
- **核心能力**：
  - 事件发布/订阅（Pub/Sub）
  - 主题（Topic）管理
  - 事件持久化和重放
- **验收标准**：
  - 事件发布延迟 < 10ms
  - 事件传递延迟 < 100ms
  - 历史事件可查询和重放

**实现约束**（供架构阶段参考）：
- 优先考虑集成成熟消息队列（降低开发成本、提高可靠性）
- 需支持高吞吐量（系统解耦的核心组件）
- 需支持事件持久化（审计和重放需求）
- 需提供统一的 API 封装层（隔离底层实现）

**架构阶段决策点**：
- 自研 vs 集成第三方消息队列
- 如选择集成：具体产品选型（评估性能、运维复杂度、成本）
- 事件存储策略（持久化时长、存储成本）
- 与工作流服务的集成方式

---

### 2.8 国际化（Priority 8）

#### FR-I18N-001：国际化服务
- **需求**：多语言内容管理和切换
- **核心能力**：
  - Key-Value 翻译存储
  - 支持多语言（中文、英文、日文等）
  - 变量插值
  - 基于 HTTP Header/Cookie 的语言切换
- **验收标准**：
  - 翻译内容可增删改查
  - API 根据语言返回对应翻译
  - 默认语言配置生效

**实现约束**（供架构阶段参考）：
- 核心功能需自研（体现平台国际化能力）
- 需支持高并发读取（翻译访问频繁）
- 需支持翻译缓存（性能优化）
- 需提供导入导出能力（翻译管理便利）

**架构阶段决策点**：
- 翻译存储方案（数据库 vs 配置中心 vs 文件）
- 缓存策略（提升性能）
- 翻译管理工具（是否需要）

---

### 2.9 实时数据推送（Priority 9）

#### FR-REALTIME-001：实时推送服务
- **需求**：提供服务端到客户端的实时数据推送能力
- **核心能力**：
  - WebSocket 连接管理
  - 服务端主动推送
  - 数据变更推送（Database CDC）
- **验收标准**：
  - 客户端可建立 WebSocket 连接
  - 推送延迟 < 100ms
  - 数据变更自动推送到订阅客户端

**实现约束**（供架构阶段参考）：
- 优先考虑集成成熟实时推送服务（降低开发成本）
- 需支持大规模并发连接（性能要求）
- 需支持连接认证和授权（安全要求）
- 需提供统一的 API 封装层（隔离底层实现）

**架构阶段决策点**：
- 自研 vs 集成第三方实时推送服务
- 如选择集成：具体产品选型（评估性能、运维复杂度、成本）
- CDC 实现方案（数据库触发器 vs 日志解析 vs 应用层）
- 与数据模型的集成方式

---

### 2.10 API 网关（Priority 10）

#### FR-GATEWAY-001：API 网关服务
- **需求**：提供统一的 API 入口和路由能力
- **核心能力**：
  - 路由转发（基于路径）
  - 认证集成（JWT 验证）
  - 权限检查（RBAC）
  - 请求日志（Trace ID）
- **验收标准**：
  - 请求正确转发到后端服务
  - 未认证请求返回 401
  - 无权限请求返回 403
  - 所有请求有日志记录

**MVP 不包含**：
- ❌ 限流（Rate Limiting）
- ❌ 熔断降级（Circuit Breaker）
- ❌ 服务发现（Service Discovery）

**实现约束**（供架构阶段参考）：
- 需评估自研 vs 集成（考虑定制需求和维护成本）
- 需支持高性能（所有请求的入口）
- 需支持灵活的路由规则（业务扩展需求）
- 需与认证服务深度集成（统一认证入口）

**架构阶段决策点**：
- 自研 vs 集成第三方网关框架
- 如选择集成：具体产品选型（评估性能、定制能力、学习成本）
- 路由规则存储方式（代码 vs 配置中心）
- 与认证服务的集成方式

---

### 2.11 日志与监控（Priority 11）

#### FR-LOG-001：日志和监控服务
- **需求**：提供集中式日志收集和系统监控能力
- **核心能力**：
  - 集中式日志收集（统一格式、Trace ID）
  - 日志查询（时间范围、关键词、Trace ID）
  - 基础性能指标（CPU, 内存, API 响应时间, QPS）
  - 告警规则和通知
- **验收标准**：
  - 所有模块日志可统一查询
  - 日志查询响应 < 5秒
  - 性能指标实时可查
  - 告警延迟 < 1 分钟

**MVP 不包含**：
- ❌ 分布式追踪（Distributed Tracing）
- ❌ 自定义 Dashboard
- ❌ AI 驱动的异常检测

**实现约束**（供架构阶段参考）：
- 优先考虑集成成熟日志和监控方案（降低开发成本）
- 需支持高吞吐量日志收集（系统规模扩展）
- 需支持长期存储（审计和分析需求）
- 需提供统一的日志格式标准（便于分析）

**架构阶段决策点**：
- 日志方案选型（评估性能、存储成本、查询能力）
- 监控方案选型（评估指标丰富度、可视化能力）
- 日志存储策略（保留时长、存储成本）
- 告警通知渠道（邮件、Webhook、短信等）

---

### 2.12 License 管理（Priority 12）

#### FR-LICENSE-001：License 管理服务
- **需求**：License 生成、验证和功能控制
- **核心能力**：
  - License 生成（试用、标准、企业）
  - License 验证（签名、有效期）
  - 基于 License 的功能开关
- **验收标准**：
  - 无效 License 系统拒绝启动
  - 过期 License 提示续期
  - 不同版本 License 功能正确限制

**实现约束**（供架构阶段参考）：
- 核心功能需自研（商业化能力）
- 需保证 License 安全性（防篡改、防破解）
- 需支持离线验证（企业内网环境）
- 需支持灵活的功能开关（商业策略）

**架构阶段决策点**：
- License 加密和签名算法
- License 存储和分发方式
- 功能开关实现机制

---

## 3. 非功能需求（NFR）

### 3.1 性能要求

- **NFR-PERF-001**：API 响应时间 P95 < 100ms（1000 并发）
- **NFR-PERF-002**：系统吞吐量 > 10,000 QPS
- **NFR-PERF-003**：实时推送延迟 < 100ms（P95）

### 3.2 可用性要求

- **NFR-AVAIL-001**：系统可用性 > 99.9%（月度）
- **NFR-AVAIL-002**：API 错误率 < 0.1%

### 3.3 可扩展性要求

- **NFR-SCALE-001**：支持水平扩展（无状态服务设计）
- **NFR-SCALE-002**：模块可独立部署和升级

### 3.4 安全性要求

- **NFR-SEC-001**：敏感数据加密（密码 bcrypt, HTTPS/TLS）
- **NFR-SEC-002**：SQL 注入防护（参数化查询）
- **NFR-SEC-003**：所有 API 需认证和授权

### 3.5 可维护性要求

- **NFR-MAINT-001**：单元测试覆盖率 > 70%
- **NFR-MAINT-002**：完善的日志和监控体系

### 3.6 可部署性要求

- **NFR-DEPLOY-001**：Docker 容器化部署（docker-compose 一键启动）
- **NFR-DEPLOY-002**：配置外部化（环境变量/配置文件）

### 3.7 轻量级要求

- **NFR-LIGHT-001**：单机（4C8G）可运行核心功能
- **NFR-LIGHT-002**：核心服务内存占用 < 512MB，CPU < 50%（空闲时）

### 3.8 开发规范要求

#### NFR-STD-001：API 设计规范
- **要求**：所有 API 遵循统一的设计规范
- **关键要点**：
  - 统一的响应格式（成功/失败）
  - RESTful 风格（资源命名、HTTP 方法）
  - 统一的错误码体系
  - API 版本管理策略
- **参考文档**：`docs/standards/api-design-guidelines.md`（架构阶段创建）
- **验收标准**：
  - API 响应格式符合规范
  - 错误码使用统一标准
  - API 文档完整且符合规范

#### NFR-STD-002：代码质量规范
- **要求**：代码遵循团队编码标准
- **关键要点**：
  - 命名规范（变量、函数、类）
  - 代码结构（分层架构、模块划分）
  - 依赖注入（优先使用构造函数注入）
  - 错误处理（统一的错误处理机制）
- **参考文档**：`docs/standards/coding-standards.md`（架构阶段创建）
- **验收标准**：
  - 代码通过静态分析工具检查
  - 单元测试覆盖率 > 70%
  - 代码审查通过

#### NFR-STD-003：测试规范
- **要求**：完善的测试体系
- **关键要点**：
  - 单元测试（核心逻辑）
  - 集成测试（模块间交互）
  - 端到端测试（关键业务流程）
  - 测试数据管理
- **参考文档**：`docs/standards/testing-guidelines.md`（架构阶段创建）
- **验收标准**：
  - 单元测试覆盖率 > 70%
  - 集成测试覆盖核心模块
  - CI/CD 流程集成测试

---

## 4. 模块分类总结

### 4.1 核心自研模块（6 个）

需要深度开发和定制的模块（体现平台核心竞争力）：

1. **数据模型**：DSL 定义、自动 API 生成、Schema 迁移
2. **配置中心**：配置管理、动态更新、版本控制
3. **函数服务**：函数执行、隔离环境、日志收集
4. **国际化**：多语言管理、语言切换
5. **API 网关**：路由转发、认证集成、日志记录
6. **License 管理**：License 生成验证、功能开关

### 4.2 优先集成模块（6 个）

建议优先考虑集成成熟第三方组件的模块（降低开发成本、提高可靠性）：

1. **认证与权限**：用户认证、授权、多租户隔离
2. **存储服务**：对象存储、文件管理
3. **工作流服务**：工作流编排和执行
4. **事件中心**：消息发布/订阅、事件总线
5. **实时推送**：WebSocket、服务端推送
6. **日志与监控**：日志收集、性能监控、告警

> **说明**：具体采用自研还是集成，以及集成哪个第三方组件，将在技术架构阶段深度评估和决策。

### 4.3 架构阶段关键决策点

需要在技术架构阶段深度评估的 9 个关键决策：

1. **认证服务**：自研 vs 集成（如集成，需选型和设计集成方案）
2. **数据模型 ORM**：框架选型（评估性能、易用性、社区支持）
3. **配置推送机制**：技术选型（WebSocket vs 长轮询 vs gRPC）
4. **函数运行时**：技术选型（容器 vs WASM vs 进程隔离）
5. **对象存储**：自研 vs 集成（如集成，需选型和多后端支持策略）
6. **工作流引擎**：集成方案设计（已有 Waterflow 项目）
7. **事件总线**：自研 vs 集成（如集成，需选型和评估）
8. **实时推送**：自研 vs 集成（如集成，需选型和 CDC 方案设计）
9. **API 网关**：自研 vs 集成（如集成，需选型和定制方案）
10. **日志监控**：方案选型（评估成本、功能、运维复杂度）
11. **部署架构**：单体 vs 微服务 vs 混合模式

---

## 5. MVP 范围说明

### 5.1 MVP 包含的功能

本 PRD 定义的所有 FR 和 NFR 均为 MVP 范围内。

### 5.2 MVP 不包含的功能

- ❌ 数据备份与恢复（属于运维功能，可在后续版本通过云服务商或第三方工具提供）
- ❌ 可视化工作流编排器（Drag & Drop UI）
- ❌ 高级图片编辑（滤镜、水印）
- ❌ 视频/音频处理
- ❌ API 网关高级功能（限流、熔断、服务发现）
- ❌ 分布式追踪（Distributed Tracing）
- ❌ 自定义监控 Dashboard
- ❌ AI/ML 集成
- ❌ 移动端原生应用

### 5.3 优先级说明

参考 [Product Brief - MVP Scope](./analysis/product-brief.md#mvp-scope) 中定义的 12 个核心模块优先级。

---

## 6. 验收标准

### 6.1 功能验收

所有功能需求（FR-xxx）的验收标准必须满足。

### 6.2 性能验收

所有非功能需求（NFR-xxx）的验收标准必须满足。

### 6.3 集成测试

- 核心模块集成测试通过
- 第三方组件集成测试通过
- 端到端场景测试通过

### 6.4 文档交付

- 技术架构设计文档
- API 文档
- 部署文档
- 第三方组件集成指南

---

## 7. 附录

### 7.1 术语表

| 术语 | 全称 | 说明 |
|------|------|------|
| FR | Functional Requirement | 功能需求 |
| NFR | Non-Functional Requirement | 非功能需求 |
| RBAC | Role-Based Access Control | 基于角色的访问控制 |
| JWT | JSON Web Token | JSON Web 令牌 |
| CRUD | Create, Read, Update, Delete | 增删改查 |
| QPS | Queries Per Second | 每秒查询数 |
| P95 | 95th Percentile | 95 百分位 |
| CDC | Change Data Capture | 数据变更捕获 |
| DSL | Domain-Specific Language | 领域特定语言 |

### 7.2 参考文档

- [Product Brief](./analysis/product-brief.md) - 产品愿景和战略
- [Technical Architecture](./architecture/) - 技术架构设计（待创建）
- [Waterflow](https://github.com/Websoft9/Waterflow) - 工作流引擎项目


**文档版本**：5.0-bmad-compliant  
**最后更新**：2025-12-24  
**变更记录**：
- v5.0 (2025-12-24): BMad 方法论合规性调整 - 移除具体技术名称，改为能力描述+实现约束，技术选型推迟到架构阶段；新增 NFR-STD 开发规范要求
- v4.0 (2025-12-24): 大幅简化，从 42 个 FR 精简到 13 个，明确区分自研模块(6)和集成模块(6)
- v3.0 (2025-12-24): 基于 Product Brief 优化，新增多租户、Schema 迁移等需求，共 42 个 FR
- v2.0 (2025-12-24): 简化版 PRD，从 3951 行精简到 677 行
- v1.0 (2025-12-23): 初始版本

**下一步**：
1. 技术架构设计（评估技术选型、设计集成方案）
2. 创建开发规范文档（API 设计规范、编码规范、测试规范）
